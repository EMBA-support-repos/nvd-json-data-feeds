{
  "id": "CVE-2024-39496",
  "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
  "published": "2024-07-12T13:15:12.253",
  "lastModified": "2024-07-12T16:34:58.687",
  "vulnStatus": "Awaiting Analysis",
  "cveTags": [],
  "descriptions": [
    {
      "lang": "en",
      "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: zoned: fix use-after-free due to race with dev replace\n\nWhile loading a zone's info during creation of a block group, we can race\nwith a device replace operation and then trigger a use-after-free on the\ndevice that was just replaced (source device of the replace operation).\n\nThis happens because at btrfs_load_zone_info() we extract a device from\nthe chunk map into a local variable and then use the device while not\nunder the protection of the device replace rwsem. So if there's a device\nreplace operation happening when we extract the device and that device\nis the source of the replace operation, we will trigger a use-after-free\nif before we finish using the device the replace operation finishes and\nfrees the device.\n\nFix this by enlarging the critical section under the protection of the\ndevice replace rwsem so that all uses of the device are done inside the\ncritical section."
    },
    {
      "lang": "es",
      "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: btrfs:zoned: corrige el use-after-free debido a la ejecuci\u00f3n con el reemplazo de desarrollo. Mientras cargamos la informaci\u00f3n de una zona durante la creaci\u00f3n de un grupo de bloques, podemos ejecutar una operaci\u00f3n de reemplazo de dispositivo y luego activar un use-after-free en el dispositivo que acaba de ser reemplazado (dispositivo fuente de la operaci\u00f3n de reemplazo). Esto sucede porque en btrfs_load_zone_info() extraemos un dispositivo del mapa de fragmentos en una variable local y luego usamos el dispositivo mientras no est\u00e1 bajo la protecci\u00f3n del dispositivo y reemplazamos rwsem. Entonces, si se produce una operaci\u00f3n de reemplazo de dispositivo cuando extraemos el dispositivo y ese dispositivo es la fuente de la operaci\u00f3n de reemplazo, activaremos un use-after-free si antes de terminar de usar el dispositivo la operaci\u00f3n de reemplazo finaliza y libera el dispositivo. Solucione este problema ampliando la secci\u00f3n cr\u00edtica bajo la protecci\u00f3n del dispositivo y reemplace rwsem para que todos los usos del dispositivo se realicen dentro de la secci\u00f3n cr\u00edtica."
    }
  ],
  "metrics": {},
  "references": [
    {
      "url": "https://git.kernel.org/stable/c/0090d6e1b210551e63cf43958dc7a1ec942cdde9",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/092571ef9a812566c8f2c9038d9c2a64c49788d6",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/17765964703b88d8befd899f8501150bb7e07e43",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/a0cc006f4214b87e70983c692e05bb36c59b5752",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    }
  ]
}